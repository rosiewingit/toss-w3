"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{181:function(e,t,n){n.d(t,{zA:function(){return o},rt:function(){return E},mX:function(){return c}});let r="nyam-db",a="sqlite",s="local-user",i=null;async function u(){return(0,(await Promise.all([n.e(218),n.e(17),n.e(803)]).then(n.t.bind(n,919,23))).default)({locateFile:e=>"/".concat(e)})}async function o(){if(i)return i;let e=await u(),t=await new Promise((e,t)=>{let n=indexedDB.open(r,1);n.onerror=()=>t(n.error),n.onsuccess=()=>{let r=n.result;if(!r.objectStoreNames.contains(a)){r.close(),e(null);return}let s=r.transaction(a,"readonly"),i=s.objectStore(a).get("db");i.onerror=()=>t(i.error),i.onsuccess=()=>{var t;return e(null!==(t=i.result)&&void 0!==t?t:null)},s.oncomplete=()=>r.close()},n.onupgradeneeded=e=>{e.target.result.createObjectStore(a)}});return t&&t.length>0?i=new e.Database(t):(function(e){e.run("\nCREATE TABLE IF NOT EXISTS users (\n  id TEXT PRIMARY KEY,\n  name TEXT,\n  createdAt TEXT NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS posts (\n  id TEXT PRIMARY KEY,\n  userId TEXT NOT NULL,\n  menuName TEXT NOT NULL,\n  tasteReview TEXT NOT NULL,\n  rating TEXT NOT NULL CHECK (rating IN ('good', 'best')),\n  lat REAL,\n  lng REAL,\n  city TEXT,\n  imageData TEXT NOT NULL,\n  createdAt TEXT NOT NULL,\n  FOREIGN KEY (userId) REFERENCES users(id)\n);\n\nCREATE TABLE IF NOT EXISTS saved_posts (\n  userId TEXT NOT NULL,\n  postId TEXT NOT NULL,\n  createdAt TEXT NOT NULL,\n  PRIMARY KEY (userId, postId),\n  FOREIGN KEY (userId) REFERENCES users(id),\n  FOREIGN KEY (postId) REFERENCES posts(id)\n);\n\nCREATE INDEX IF NOT EXISTS idx_posts_createdAt ON posts(createdAt DESC);\nCREATE INDEX IF NOT EXISTS idx_saved_posts_userId ON saved_posts(userId);\n");try{e.run("INSERT INTO users (id, name, createdAt) VALUES (?, ?, ?)",[s,null,new Date().toISOString()])}catch(e){}}(i=new e.Database),await c()),i}async function c(){if(!i)return;let e=i.export();await new Promise((t,n)=>{let s=indexedDB.open(r,1);s.onerror=()=>n(s.error),s.onsuccess=()=>{let r=s.result,i=r.transaction(a,"readwrite");i.objectStore(a).put(e,"db"),i.onerror=()=>n(i.error),i.oncomplete=()=>{r.close(),t()}},s.onupgradeneeded=e=>{e.target.result.createObjectStore(a)}})}function E(){return s}},5082:function(e,t,n){n.d(t,{Bd:function(){return s},HW:function(){return l},SF:function(){return u},qp:function(){return p},u_:function(){return i},ud:function(){return T},xX:function(){return o}});var r=n(181);function a(e){var t;return{id:e[0],userId:e[1],menuName:e[2],tasteReview:e[3],rating:e[4],placeName:null!==(t=e[5])&&void 0!==t?t:null,imageData:e[6],createdAt:e[7]}}async function s(){let e=(await (0,r.zA)()).exec("SELECT id, userId, menuName, tasteReview, rating, city as placeName, imageData, createdAt FROM posts ORDER BY createdAt DESC");return e.length?e[0].values.map(e=>a(e)):[]}async function i(e){let t=(await (0,r.zA)()).prepare("SELECT id, userId, menuName, tasteReview, rating, city as placeName, imageData, createdAt FROM posts WHERE id = ?");t.bind([e]);let n=t.step()?t.get():null;return t.free(),n?a(n):null}async function u(e){let t=await (0,r.zA)(),n=(0,r.rt)(),a="post-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),s=new Date().toISOString();return t.run("INSERT INTO posts (id, userId, menuName, tasteReview, rating, city, imageData, createdAt)\n     VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[a,n,e.menuName,e.tasteReview,e.rating,e.imageData,s]),await (0,r.mX)(),{id:a,userId:n,...e,createdAt:s}}async function o(e){let t=(await (0,r.zA)()).prepare("SELECT postId FROM saved_posts WHERE userId = ?");t.bind([e]);let n=[];for(;t.step();)n.push(t.get()[0]);return t.free(),new Set(n)}async function c(e,t){let n=(await (0,r.zA)()).prepare("SELECT 1 FROM saved_posts WHERE userId = ? AND postId = ?");n.bind([e,t]);let a=n.step();return n.free(),a}async function E(e){let t=await (0,r.zA)(),n=(0,r.rt)(),a=new Date().toISOString();try{t.run("INSERT INTO saved_posts (userId, postId, createdAt) VALUES (?, ?, ?)",[n,e,a]),await (0,r.mX)()}catch(e){}}async function d(e){let t=await (0,r.zA)(),n=(0,r.rt)();t.run("DELETE FROM saved_posts WHERE userId = ? AND postId = ?",[n,e]),await (0,r.mX)()}async function l(e){let t=(0,r.rt)();return await c(t,e)?(await d(e),!1):(await E(e),!0)}async function p(){let e=await (0,r.zA)(),t=(0,r.rt)(),n=e.prepare("SELECT id, userId, menuName, tasteReview, rating, city as placeName, imageData, createdAt FROM posts WHERE userId = ? ORDER BY createdAt DESC");n.bind([t]);let s=[];for(;n.step();)s.push(a(n.get()));return n.free(),s}async function T(){let e=await (0,r.zA)(),t=(0,r.rt)(),n=e.prepare("SELECT p.id, p.userId, p.menuName, p.tasteReview, p.rating, p.city as placeName, p.imageData, p.createdAt\n     FROM posts p\n     INNER JOIN saved_posts s ON p.id = s.postId\n     WHERE s.userId = ?\n     ORDER BY s.createdAt DESC");n.bind([t]);let s=[];for(;n.step();)s.push(a(n.get()));return n.free(),s}},3232:function(e,t,n){n.d(t,{insertPost:function(){return r.SF}});var r=n(5082)}}]);